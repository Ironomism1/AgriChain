# Visual Architecture: Contracts & Transactions

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AGRICHAIN PLATFORM                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FRONTEND (React)   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Transaction     â”‚  â”‚
â”‚  â”‚History View    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    HTTP Request
  GET /api/escrow/
  user-transactions
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               BACKEND (Express Server)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  GET /api/escrow/user-transactions Endpoint             â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ 1. Fetch Contracts for current user                    â”‚â”‚
â”‚  â”‚    WHERE buyerId = user OR farmerId = user             â”‚â”‚
â”‚  â”‚    â†“ Returns: product details, quality, blockchain    â”‚â”‚
â”‚  â”‚                                                        â”‚â”‚
â”‚  â”‚ 2. Fetch EscrowTransactions for current user          â”‚â”‚
â”‚  â”‚    WHERE buyerId = user OR sellerId = user            â”‚â”‚
â”‚  â”‚    â†“ Returns: payment amount, status, funds           â”‚â”‚
â”‚  â”‚                                                        â”‚â”‚
â”‚  â”‚ 3. MERGE: Link contracts to escrow via:              â”‚â”‚
â”‚  â”‚    contract.escrowTransactionId = escrow._id          â”‚â”‚
â”‚  â”‚    â†“ Returns: unified transaction with both           â”‚â”‚
â”‚  â”‚                                                        â”‚â”‚
â”‚  â”‚ 4. Filter & Sort by user-provided status/date        â”‚â”‚
â”‚  â”‚    â†“ Returns: clean, organized array                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    JSON Response
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  DATABASE (MongoDB)                           â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   contracts table   â”‚   â”‚ escowtransactions    â”‚         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚ table                â”‚         â”‚
â”‚  â”‚ _id: 123abc         â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚  â”‚ crop: wheat         â”‚   â”‚ _id: 456def          â”‚         â”‚
â”‚  â”‚ quantity: 100 kg    â”‚â”â”â”³â”â”‚ buyerId: user123     â”‚         â”‚
â”‚  â”‚ totalValue: â‚¹5000   â”‚  â•‘ â”‚ amount: â‚¹5000        â”‚         â”‚
â”‚  â”‚ stage: completed âœ… â”‚  â•‘ â”‚ status: released âœ…  â”‚         â”‚
â”‚  â”‚ blockchain: 0xdcd9..â”‚  â•‘ â”‚ fees: â‚¹100           â”‚         â”‚
â”‚  â”‚ escrowTransactionId:â”œâ”€â”€â•‹â”â”‚ _id: 456def          â”‚         â”‚
â”‚  â”‚ 456def              â”‚  â•‘ â”‚ (LINKED!)            â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚          â†‘                 â•‘                                  â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ (Foreign Key Link)             â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PAYMENT REQUEST INITIATED      â”‚
â”‚  (User: John â†’ Farmer: Ram)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   REQUEST    â”‚
        â”‚   PENDING    â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  FARMER ACCEPTS REQUEST   â”‚
        â”‚  Creates 2 things:        â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Contract Created  â”‚  â”‚ Escrow Created      â”‚
        â”‚                  â”‚  â”‚                     â”‚
        â”‚ Stores:          â”‚  â”‚ Stores:             â”‚
        â”‚ â€¢ Crop type      â”‚  â”‚ â€¢ â‚¹5000 amount      â”‚
        â”‚ â€¢ 100 kg qty     â”‚  â”‚ â€¢ Payment method    â”‚
        â”‚ â€¢ Quality std    â”‚  â”‚ â€¢ Buyer confirm     â”‚
        â”‚ â€¢ Delivery date  â”‚  â”‚ â€¢ Fees: â‚¹100        â”‚
        â”‚ â€¢ blockchain     â”‚  â”‚ â€¢ Status: pending   â”‚
        â”‚ â€¢ Stage: SIGNED  â”‚  â”‚                     â”‚
        â”‚                  â”‚  â”‚ linkedId: contract1 â”‚â—„â”€â”€â”€â”€â”€â”
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ (LINKED!)           â”‚      â”‚
               â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  LINK â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”€â”˜
                        (Foreign Key)
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  BUYER CONFIRMS PAYMENT       â”‚
        â”‚  (Razorpay/Mock)              â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Contract        â”‚  â”‚ Escrow              â”‚
        â”‚ Stage:          â”‚  â”‚ Status:             â”‚
        â”‚ âœ… ESCROWED     â”‚  â”‚ âœ… FUNDED           â”‚
        â”‚                 â”‚  â”‚                     â”‚
        â”‚ (â‚¹5000 locked)  â”‚  â”‚ (â‚¹5000 locked)      â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                    â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  FARMER SUBMITS HARVEST PROOF   â”‚
        â”‚  (Photos + GPS)                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Contract             â”‚  â”‚ Escrow           â”‚
        â”‚ Stage:               â”‚  â”‚ Status:          â”‚
        â”‚ â³ DELIVERY          â”‚  â”‚ â³ CONFIRMED     â”‚
        â”‚                      â”‚  â”‚                  â”‚
        â”‚ Verification:        â”‚  â”‚ Awaiting         â”‚
        â”‚ PENDING              â”‚  â”‚ payment release  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚                â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  BUYER VERIFIES QUALITY               â”‚
        â”‚  âœ… Approved                          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Contract                          â”‚  â”‚ Escrow          â”‚
        â”‚ Stage: âœ… VERIFIED                â”‚  â”‚ Status:         â”‚
        â”‚                                   â”‚  â”‚ âœ… RELEASED     â”‚
        â”‚ (Payment ready to release)        â”‚  â”‚                 â”‚
        â”‚                                   â”‚  â”‚ Farmer gets:    â”‚
        â”‚ Blockchain verified âœ…            â”‚  â”‚ â‚¹4,900 (fee -â‚¹100)
        â”‚ Smart contract: 0xdcd9...         â”‚  â”‚                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚                      â”‚
                                 â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚            â”‚ FARMER'S WALLET    â”‚
                                 â”‚            â”‚ Balance: +â‚¹4,900   â”‚
                                 â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ORDER COMPLETED                      â”‚
        â”‚  âœ… PAYMENT_RELEASED                  â”‚
        â”‚                                       â”‚
        â”‚  Final State:                         â”‚
        â”‚  Contract: COMPLETED                  â”‚
        â”‚  Escrow: RELEASED                     â”‚
        â”‚  Farmer: PAID âœ…                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”— The Linking Mechanism

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE STRUCTURE                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  contracts COLLECTION                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚ Document #1:                                 â”‚
â”‚ {                                            â”‚
â”‚   _id: ObjectId("507f1f77bcf86cd799439011") â”‚
â”‚   buyerId: ObjectId("user123")               â”‚
â”‚   farmerId: ObjectId("farmer456")            â”‚
â”‚   crop: "wheat"                              â”‚
â”‚   quantityKg: 100                            â”‚
â”‚   totalValue: 5000                           â”‚
â”‚   stage: "payment_released"                  â”‚
â”‚   blockchainHash: "0xdcd9c078e1f55e1..."     â”‚
â”‚   quality Standards: {...}                   â”‚
â”‚   deliveryWindowStart: ISODate(...)          â”‚
â”‚   deliveryWindowEnd: ISODate(...)            â”‚
â”‚   harvestProof: [...photos]                  â”‚
â”‚   verification: {                            â”‚
â”‚     status: "approved",                      â”‚
â”‚     approvedBy: ObjectId("admin"),           â”‚
â”‚     notes: "Quality: Excellent"              â”‚
â”‚   }                                          â”‚
â”‚   escrowTransactionId: â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚     ObjectId("507f1f77bcf86cd799439012")â”‚   â”‚
â”‚   createdAt: ISODate(...)                â”‚   â”‚
â”‚   updatedAt: ISODate(...)                â”‚   â”‚
â”‚ }                                        â”‚   â”‚
â”‚                                          â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”
â”‚  escowtransactions COLLECTION            â”‚   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚ Document:                                    â”‚
â”‚ {                                            â”‚
â”‚   _id: ObjectId("507f1f77bcf86cd799439012")â”€â”¤â”€â”€â”
â”‚   buyerId: ObjectId("user123")               â”‚  â”‚
â”‚   sellerId: ObjectId("farmer456")            â”‚  â”‚
â”‚   transactionId: "ESC-1763635907..."         â”‚  â”‚
â”‚   crop: "wheat"                              â”‚  â”‚
â”‚   quantity: 100                              â”‚  â”‚
â”‚   unit: "kg"                                 â”‚  â”‚
â”‚   amount: 5000                               â”‚  â”‚
â”‚   currency: "INR"                            â”‚  â”‚
â”‚   fees: {                                    â”‚  â”‚
â”‚     platformFee: 100,                        â”‚  â”‚
â”‚     totalFee: 100,                           â”‚  â”‚
â”‚     sellerAmount: 4900                       â”‚  â”‚
â”‚   }                                          â”‚  â”‚
â”‚   payment: {                                 â”‚  â”‚
â”‚     method: "mock",                          â”‚  â”‚
â”‚     status: "released",                      â”‚  â”‚
â”‚     razorpaySignature: "sig_123"             â”‚  â”‚
â”‚   }                                          â”‚  â”‚
â”‚   status: "released" âœ…                      â”‚  â”‚
â”‚   stage: "payment_released"                  â”‚  â”‚
â”‚   createdAt: ISODate(...)                    â”‚  â”‚
â”‚   updatedAt: ISODate(...)                    â”‚  â”‚
â”‚ }                                            â”‚  â”‚
â”‚                                              â”‚  â”‚
â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ (References Contract _id)                       â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

          BIDIRECTIONAL LINK
        contract â†’ escrow (primary)
        escrow contains all details
```

---

## ğŸ“‹ Unified Transaction Response

```javascript
GET /api/escrow/user-transactions

RESPONSE:
{
  "success": true,
  "count": 1,
  "transactions": [
    {
      // FROM CONTRACT:
      "id": "507f1f77bcf86cd799439011",
      "type": "contract",
      "crop": "wheat",
      "quantity": 100,
      "unit": "kg",
      "stage": "payment_released",
      "qualityStandards": {
        "moisture": "11-12%",
        "protein": "13%",
        "falling_number": "300+"
      },
      "blockchainHash": "0xdcd9c078e1f55...",
      "harvestProof": [
        {
          "type": "photo",
          "url": "ipfs://QmXx...",
          "timestamp": "2025-11-19T04:00:00Z"
        }
      ],
      "verification": {
        "status": "approved",
        "approvedBy": "admin@agrichain.com",
        "notes": "Quality: Excellent âœ…"
      },
      
      // THE LINK:
      "escrowTransactionId": "507f1f77bcf86cd799439012",
      
      // FROM ESCROW:
      "escrowData": {
        "transactionId": "ESC-1763635907...",
        "amount": 5000,
        "currency": "INR",
        "status": "released",
        "paymentMethod": "mock",
        "fees": {
          "platformFee": 100,
          "sellerAmount": 4900
        },
        "deliveryWindowStart": "2025-11-20",
        "deliveryWindowEnd": "2025-11-25"
      },
      
      // METADATA:
      "buyerId": "user123",
      "farmerId": "farmer456",
      "buyer": {
        "_id": "user123",
        "name": "John Buyer",
        "email": "john@example.com",
        "avatar": "..."
      },
      "seller": {
        "_id": "farmer456",
        "name": "Ram Farmer",
        "email": "ram@example.com",
        "avatar": "..."
      },
      "createdAt": "2025-11-19T00:00:00Z",
      "updatedAt": "2025-11-19T04:16:00Z"
    }
  ],
  "summary": {
    "total": 1,
    "byType": {
      "contracts": 1,
      "escrow": 0
    },
    "byStatus": {
      "pending": 0,
      "completed": 1,
      "disputed": 0
    }
  }
}
```

---

## ğŸ¯ Complete Journey View

```
USER SEES THIS IN TRANSACTION HISTORY:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  wheat (Mock)                                      â”‚
â”‚  #ESC-1763635907...                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ… RELEASED                                        â”‚
â”‚  Payment sent to farmer                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  DETAILS:                                          â”‚
â”‚  â”œâ”€ Quantity: 100 kg                               â”‚
â”‚  â”œâ”€ Amount: â‚¹6,000                                 â”‚
â”‚  â”œâ”€ Payment Type: Mock                             â”‚
â”‚  â”œâ”€ Seller: Demo Seller                            â”‚
â”‚  â”‚                                                 â”‚
â”‚  â”œâ”€ Quality Standards:                             â”‚
â”‚  â”‚  â””â”€ Moisture: 11-12%, Protein: 13%             â”‚
â”‚  â”‚                                                 â”‚
â”‚  â”œâ”€ ğŸ”— Blockchain Hash:                            â”‚
â”‚  â”‚  â””â”€ 0xdcd9c078e1f55e1...                        â”‚
â”‚  â”‚     (Smart contract on-chain)                   â”‚
â”‚  â”‚                                                 â”‚
â”‚  â”œâ”€ Harvest Proof:                                 â”‚
â”‚  â”‚  â”œâ”€ ğŸ“· Photo 1: ipfs://QmXx... (Nov 19)         â”‚
â”‚  â”‚  â”œâ”€ ğŸ“· Photo 2: ipfs://QmYy... (Nov 19)         â”‚
â”‚  â”‚  â””â”€ ğŸ“ GPS: 17.3850Â° N, 78.4867Â° E             â”‚
â”‚  â”‚                                                 â”‚
â”‚  â”œâ”€ âœ… Verification:                               â”‚
â”‚  â”‚  â””â”€ Approved by Admin on Nov 19, 04:16 PM      â”‚
â”‚  â”‚     "Quality: Excellent âœ…"                    â”‚
â”‚  â”‚                                                 â”‚
â”‚  â”œâ”€ ğŸ“¦ Delivered: Nov 19, 2025, 04:16 PM           â”‚
â”‚  â”‚                                                 â”‚
â”‚  â””â”€ âœ… You already reviewed this                   â”‚
â”‚     Rating: â­â­â­â­â­ (5/5)                        â”‚
â”‚     Review: "Excellent quality wheat!"             â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ALL OF THIS COMES FROM:
â”œâ”€ CONTRACT (product details, blockchain, quality)
â””â”€ ESCROW (payment details, funds, status)
   MERGED INTO ONE VIEW âœ…
```

---

## ğŸ”„ Complete System Loop

```
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  USER INITIATES â”‚
           â”‚  PAYMENT REQ    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ FARMER ACCEPTS        â”‚
        â”‚ (Triggers creation)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                           â”‚
    â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CONTRACT   â”‚          â”‚ ESCROW         â”‚
â”‚ CREATED    â”‚          â”‚ TRANSACTION    â”‚
â”‚            â”‚          â”‚ CREATED        â”‚
â”‚ Stores:    â”‚          â”‚                â”‚
â”‚ â€¢ Product  â”‚          â”‚ Stores:        â”‚
â”‚ â€¢ Quality  â”‚          â”‚ â€¢ Amount       â”‚
â”‚ â€¢ Date     â”‚          â”‚ â€¢ Payment      â”‚
â”‚ â€¢ Blockchain          â”‚ â€¢ Status       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ LINKED via escrowTransactionId
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  UNIFIED TRANSACTION     â”‚
    â”‚  (Ready for API calls)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ FRONTEND DISPLAYS         â”‚
    â”‚ Transaction Details       â”‚
    â”‚ WITH BOTH:                â”‚
    â”‚ âœ… Product info (contract)â”‚
    â”‚ âœ… Payment info (escrow)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**That's it! Contracts and Transactions are now perfectly linked and presented as one unified view.** âœ¨
